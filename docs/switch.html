<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolli Clinici: Switch Anticoagulanti Orali (DOAC/VKA)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Palette: Energetic & Playful -->
    <!-- Primary: #7C3AED (Violet) -->
    <!-- Secondary: #06B6D4 (Cyan) -->
    <!-- Accent: #F59E0B (Amber) -->
    <!-- Critical: #EC4899 (Pink/Red) -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6;
            color: #1F2937;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%; 
            height: 350px;
            max-height: 400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        
        .card-shadow:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .timeline-box {
            position: relative;
            padding-left: 20px;
            border-left: 4px solid #7C3AED;
        }
    </style>
    <!-- 
        Analysis Summary:
        1. Material: Medical guidelines for switching anticoagulants (DOAC <-> VKA).
        2. Narrative: Introduction -> Pharmacology Comparison -> Switch VKA to DOAC (INR dependent) -> Switch DOAC to VKA (Overlap dependent) -> Special Pop (Renal) -> Conclusion.
        3. Visualizations:
           - Radar Chart: Pharmacology comparison (Goal: Compare).
           - Horizontal Bar: INR Thresholds (Goal: Inform/Organize).
           - Floating Bar/Gantt: Overlap timeline (Goal: Change/Process).
           - Grouped Bar: Renal adjustments (Goal: Compare).
        4. Constraint Check: No SVG, No Mermaid used. All charts Canvas/HTML.
    -->
</head>
<body class="bg-gray-100">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white shadow-md border-b-4 border-violet-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <span class="text-2xl font-extrabold text-violet-700 tracking-tight">HEMA<span class="text-cyan-500">GUIDE</span></span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="#intro" class="text-gray-700 hover:text-violet-600 font-medium">Panoramica</a>
                    <a href="#vka-to-doac" class="text-gray-700 hover:text-violet-600 font-medium">VKA &rarr; DOAC</a>
                    <a href="#doac-to-vka" class="text-gray-700 hover:text-violet-600 font-medium">DOAC &rarr; VKA</a>
                    <a href="#renal" class="text-gray-700 hover:text-violet-600 font-medium">Insufficienza Renale</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-violet-700 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4">Gestione dello Switch Anticoagulante</h1>
            <p class="text-xl md:text-2xl font-light text-violet-100 max-w-3xl">
                Guida operativa per il Medico di Medicina Generale: protocolli di transizione tra Antagonisti della Vitamina K (Warfarin/Acenocumarolo) e Anticoagulanti Orali Diretti (DOAC).
            </p>
            <div class="mt-8 flex flex-wrap gap-4">
                <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                    <span class="block text-2xl font-bold text-amber-400">4</span>
                    <span class="text-sm font-medium">Molecole DOAC Principali</span>
                </div>
                <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                    <span class="block text-2xl font-bold text-cyan-400">Strict</span>
                    <span class="text-sm font-medium">Monitoraggio INR</span>
                </div>
                <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 border border-white/20">
                    <span class="block text-2xl font-bold text-pink-400">Overlap</span>
                    <span class="text-sm font-medium">Protocolli di Transizione</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Section 1: Pharmacology Comparison -->
        <section id="intro" class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
            <div>
                <h2 class="text-3xl font-bold text-gray-900 mb-4 border-l-8 border-cyan-500 pl-4">Farmacodinamica a Confronto</h2>
                <p class="text-gray-600 mb-6 text-lg leading-relaxed">
                    La transizione tra VKA e DOAC richiede una profonda comprensione delle differenze farmacocinetiche. Mentre il Warfarin ha un'emivita lunga e un onset ritardato, i DOAC agiscono rapidamente ("on-off").
                    <br><br>
                    <strong>Punto Chiave:</strong> Il rischio trombotico o emorragico durante lo switch deriva spesso dalla sovrapposizione errata o dalla "finestra scoperta" dovuta a queste differenze.
                </p>
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-amber-500">
                    <h3 class="font-bold text-lg mb-2 text-amber-600">Considerazioni Critiche</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li><strong>VKA (Warfarin):</strong> Monitoraggio INR obbligatorio, interazioni alimentari multiple.</li>
                        <li><strong>DOAC:</strong> Dose fissa, nessuna routine INR, eliminazione renale variabile.</li>
                    </ul>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-xl shadow-md card-shadow">
                <div class="chart-container">
                    <canvas id="pharmaRadar"></canvas>
                </div>
                <p class="text-xs text-center text-gray-500 mt-2">
                    Fig 1. Confronto qualitativo dei profili farmacologici. Notare la rapidità d'azione dei DOAC vs la dipendenza dal monitoraggio del VKA.
                </p>
            </div>
        </section>

        <!-- Section 2: Warfarin -> DOAC Switch -->
        <section id="vka-to-doac">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-4 border-l-8 border-violet-600 pl-4">Switch: Da Warfarin a DOAC</h2>
                <p class="text-gray-600 text-lg">
                    La regola d'oro è: <strong>STOP Warfarin</strong> e monitorare l'INR. L'inizio del DOAC dipende rigorosamente dal valore di INR al momento della sospensione e nei giorni successivi. Non somministrare mai il DOAC se l'INR è sovra-terapeutico.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Text Cards -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-cyan-500">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Dabigatran & Apixaban</h3>
                        <p class="text-gray-600">Start immediato quando <strong>INR &lt; 2.0</strong>.</p>
                        <div class="mt-4 bg-cyan-50 p-3 rounded text-cyan-800 text-sm font-semibold">
                            ⚠️ Rischio Emorragico se start con INR > 2.0
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-violet-500">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Edoxaban</h3>
                        <p class="text-gray-600">Start consentito quando <strong>INR &le; 2.5</strong>.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-pink-500">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Rivaroxaban</h3>
                        <p class="text-gray-600">Start consentito quando <strong>INR &le; 3.0</strong>.</p>
                        <div class="mt-4 bg-pink-50 p-3 rounded text-pink-800 text-sm font-semibold">
                            Nota: Sebbene il cut-off sia 3.0, molti clinici preferiscono attendere INR < 2.5 per sicurezza.
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md card-shadow">
                    <h3 class="text-lg font-bold text-gray-700 mb-4">Soglie di Sicurezza INR per Start DOAC</h3>
                    <div class="chart-container">
                        <canvas id="inrSwitchChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 italic">
                        Il grafico mostra il valore massimo di INR a cui è consentito iniziare la terapia con lo specifico DOAC dopo la sospensione del Warfarin.
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 3: DOAC -> Warfarin Switch -->
        <section id="doac-to-vka" class="bg-white rounded-2xl shadow-xl p-8 border border-gray-200">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-4 border-l-8 border-pink-500 pl-4">Switch: Da DOAC a Warfarin</h2>
                <p class="text-gray-600 text-lg">
                    Questa transizione è più complessa a causa del lento onset del Warfarin. È necessario un periodo di <strong>co-somministrazione (Overlap)</strong> per evitare finestre terapeutiche scoperte (rischio trombotico).
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <!-- Methodology -->
                <div>
                    <h3 class="text-2xl font-bold text-violet-700 mb-4">Metodologia di Overlap</h3>
                    <div class="space-y-6">
                        <div class="timeline-box">
                            <h4 class="text-lg font-bold text-gray-800">Giorno 0: Inizio VKA</h4>
                            <p class="text-gray-600">Mantenere il DOAC alla dose abituale. Iniziare Warfarin alla dose standard (es. 5mg) o secondo algoritmo locale.</p>
                        </div>
                        <div class="timeline-box border-amber-500">
                            <h4 class="text-lg font-bold text-gray-800">Giorni successivi: Co-somministrazione</h4>
                            <p class="text-gray-600">Continuare <strong>DOAC + Warfarin</strong> contemporaneamente.</p>
                            <p class="text-gray-600 mt-2">Monitorare INR appena prima della dose successiva di DOAC (livello di valle).</p>
                        </div>
                        <div class="timeline-box border-cyan-500">
                            <h4 class="text-lg font-bold text-gray-800">Stop DOAC</h4>
                            <p class="text-gray-600">Sospendere il DOAC solo quando <strong>INR &ge; 2.0</strong>.</p>
                            <p class="text-sm text-cyan-700 mt-2 font-semibold">Nota: Edoxaban richiede dose ridotta al 50% durante l'overlap.</p>
                        </div>
                    </div>
                </div>

                <!-- Visual Chart Overlap -->
                <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-700 mb-2 text-center">Visualizzazione Overlap Terapico</h3>
                    <div class="chart-container">
                        <canvas id="overlapChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        Simulazione temporale: Il DOAC (Viola) continua finché il Warfarin (Ambra) non raggiunge l'efficacia terapeutica (INR > 2).
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 4: Specific Protocols Table Replacement (Cards) -->
        <section>
            <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Schede di Transizione per Molecola</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                
                <!-- Dabigatran -->
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow border-t-8 border-blue-600 p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Dabigatran</h3>
                    <span class="text-xs font-semibold text-blue-600 bg-blue-100 py-1 px-2 rounded w-max mb-4">Inibitore Trombina</span>
                    
                    <div class="mb-4">
                        <strong class="block text-sm text-gray-500 uppercase">DOAC &rarr; VKA</strong>
                        <p class="text-sm text-gray-700 mt-1">
                            Start VKA basato su CrCl:<br>
                            &bull; CrCl &ge; 50: Start VKA 3gg prima stop DOAC.<br>
                            &bull; CrCl 30-49: Start VKA 2gg prima stop DOAC.<br>
                            &bull; CrCl 15-29: Start VKA 1gg prima stop DOAC.
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-gray-100">
                        <strong class="block text-sm text-gray-500 uppercase">VKA &rarr; DOAC</strong>
                        <p class="text-sm text-gray-700 mt-1">Stop VKA. Start quando INR &lt; 2.0.</p>
                    </div>
                </div>

                <!-- Rivaroxaban -->
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow border-t-8 border-red-600 p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Rivaroxaban</h3>
                    <span class="text-xs font-semibold text-red-600 bg-red-100 py-1 px-2 rounded w-max mb-4">Inibitore Xa</span>
                    
                    <div class="mb-4">
                        <strong class="block text-sm text-gray-500 uppercase">DOAC &rarr; VKA</strong>
                        <p class="text-sm text-gray-700 mt-1">
                            Co-somministrare DOAC + VKA. Stop DOAC quando INR &ge; 2.0.
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-gray-100">
                        <strong class="block text-sm text-gray-500 uppercase">VKA &rarr; DOAC</strong>
                        <p class="text-sm text-gray-700 mt-1">Stop VKA. Start quando INR &le; 3.0 (Prudenza > 2.5).</p>
                    </div>
                </div>

                <!-- Apixaban -->
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow border-t-8 border-yellow-500 p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Apixaban</h3>
                    <span class="text-xs font-semibold text-yellow-600 bg-yellow-100 py-1 px-2 rounded w-max mb-4">Inibitore Xa</span>
                    
                    <div class="mb-4">
                        <strong class="block text-sm text-gray-500 uppercase">DOAC &rarr; VKA</strong>
                        <p class="text-sm text-gray-700 mt-1">
                            Co-somministrare DOAC + VKA. Stop DOAC quando INR &ge; 2.0. Monitorare INR prima della dose successiva.
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-gray-100">
                        <strong class="block text-sm text-gray-500 uppercase">VKA &rarr; DOAC</strong>
                        <p class="text-sm text-gray-700 mt-1">Stop VKA. Start quando INR &lt; 2.0.</p>
                    </div>
                </div>

                <!-- Edoxaban -->
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow border-t-8 border-purple-600 p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Edoxaban</h3>
                    <span class="text-xs font-semibold text-purple-600 bg-purple-100 py-1 px-2 rounded w-max mb-4">Inibitore Xa</span>
                    
                    <div class="mb-4">
                        <strong class="block text-sm text-gray-500 uppercase">DOAC &rarr; VKA</strong>
                        <p class="text-sm text-gray-700 mt-1">
                            <span class="text-red-500 font-bold">ATTENZIONE:</span> Ridurre dose Edoxaban al 50% (es. 60->30mg) durante l'overlap con VKA. Stop quando INR &ge; 2.0.
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-gray-100">
                        <strong class="block text-sm text-gray-500 uppercase">VKA &rarr; DOAC</strong>
                        <p class="text-sm text-gray-700 mt-1">Stop VKA. Start quando INR &le; 2.5.</p>
                    </div>
                </div>

            </div>
        </section>

        <!-- Section 5: Renal Function & Monitoring -->
        <section id="renal" class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <div class="lg:col-span-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-violet-700 h-full">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Impatto della Funzionalità Renale</h2>
                    <p class="text-gray-600 mb-6">
                        La Clearance della Creatinina (CrCl), calcolata preferibilmente con la formula di Cockcroft-Gault, è il determinante principale per il dosaggio dei DOAC e per la sicurezza dello switch. Il Dabigatran, essendo eliminato all'80% per via renale, richiede la massima cautela.
                    </p>
                    <div class="chart-container">
                        <canvas id="renalChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        Fig 4. Cut-off di CrCl (ml/min) per l'uso sicuro o l'aggiustamento posologico dei DOAC.
                    </p>
                </div>
            </div>
            
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-amber-50 p-6 rounded-xl border border-amber-200">
                    <h3 class="text-xl font-bold text-amber-800 mb-3 flex items-center">
                        <span class="text-2xl mr-2">&#9888;</span> Bridging con Eparina
                    </h3>
                    <p class="text-sm text-amber-900 mb-2">
                        <strong>Da VKA a DOAC:</strong> Il bridging con LMWH (Eparina a Basso Peso Molecolare) non è generalmente necessario se l'INR è monitorato e il DOAC iniziato tempestivamente.
                    </p>
                    <p class="text-sm text-amber-900">
                        <strong>Da DOAC a VKA:</strong> Il bridging con LMWH non è necessario se si effettua l'overlap corretto (co-somministrazione). Se l'overlap orale non è possibile, somministrare LMWH + VKA e stop DOAC (approccio classico).
                    </p>
                </div>

                <div class="bg-violet-900 text-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-bold mb-4">Checklist Rapida MMG</h3>
                    <ul class="space-y-3 text-sm font-light">
                        <li class="flex items-start">
                            <span class="mr-2 text-cyan-400 font-bold">&check;</span>
                            Calcolare CrCl (non solo eGFR).
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-cyan-400 font-bold">&check;</span>
                            Verificare interazioni (es. Amiodarone, Verapamil, Antifungini).
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-cyan-400 font-bold">&check;</span>
                            Nello switch DOAC->VKA, enfatizzare l'aderenza durante l'overlap.
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-cyan-400 font-bold">&check;</span>
                            Programmare INR seriali (giornalieri o a giorni alterni) durante lo switch.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm mb-2">Developed by Canvas Infographics &bull; Expert Hematology Frontend</p>
            <p class="text-xs max-w-2xl mx-auto">
                DISCLAIMER MEDICO: Questa infografica è uno strumento di supporto decisionale destinato esclusivamente a professionisti sanitari. Le informazioni non sostituiscono il giudizio clinico, le linee guida ufficiali (AIFA/ESC) o il RCP dei singoli farmaci. L'autore declina ogni responsabilità per l'uso improprio delle informazioni.
            </p>
            <!-- Palette Credit: Energetic & Playful -->
        </div>
    </footer>

    <script>
        // --- UTILITY FUNCTIONS ---
        
        // Function to split long labels for Chart.js (16 char limit logic)
        function splitLabel(str) {
            const limit = 16;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= limit) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Standard Tooltip Callback for Multiline support
        const tooltipPlugin = {
            tooltip: {
                callbacks: {
                    title: function(tooltipItems) {
                        const item = tooltipItems[0];
                        let label = item.chart.data.labels[item.dataIndex];
                        if (Array.isArray(label)) {
                            return label.join(' ');
                        } else {
                            return label;
                        }
                    }
                }
            }
        };

        // --- CHART 1: PHARMACOLOGY RADAR (DOAC vs VKA) ---
        const ctxPharma = document.getElementById('pharmaRadar').getContext('2d');
        new Chart(ctxPharma, {
            type: 'radar',
            data: {
                labels: ['Rapidità Onset', 'Emivita Breve', 'Interazioni Cibo', 'Interazioni Farmaci', 'Necessità Monitoraggio'].map(splitLabel),
                datasets: [{
                    label: 'DOAC (Nuovi Orali)',
                    data: [9, 9, 2, 4, 1], // High onset, Short half life, Low interactions, Low monitoring
                    fill: true,
                    backgroundColor: 'rgba(6, 182, 212, 0.2)', // Cyan
                    borderColor: '#06B6D4',
                    pointBackgroundColor: '#06B6D4',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#06B6D4'
                }, {
                    label: 'VKA (Warfarin)',
                    data: [2, 2, 9, 9, 10], // Slow onset, Long half life, High interactions, High monitoring
                    fill: true,
                    backgroundColor: 'rgba(245, 158, 11, 0.2)', // Amber
                    borderColor: '#F59E0B',
                    pointBackgroundColor: '#F59E0B',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#F59E0B'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: { line: { borderWidth: 3 } },
                scales: {
                    r: {
                        angleLines: { display: true },
                        suggestedMin: 0,
                        suggestedMax: 10,
                        grid: { color: 'rgba(0,0,0,0.1)' },
                        pointLabels: {
                            font: { size: 12, family: 'Inter' },
                            color: '#4B5563'
                        }
                    }
                },
                plugins: tooltipPlugin
            }
        });

        // --- CHART 2: INR THRESHOLDS (Horizontal Bar) ---
        const ctxInr = document.getElementById('inrSwitchChart').getContext('2d');
        new Chart(ctxInr, {
            type: 'bar',
            data: {
                labels: ['Dabigatran', 'Apixaban', 'Edoxaban', 'Rivaroxaban'].map(splitLabel),
                datasets: [{
                    label: 'Soglia INR per Start',
                    data: [2.0, 2.0, 2.5, 3.0],
                    backgroundColor: [
                        '#3B82F6', // Blue
                        '#F59E0B', // Amber
                        '#8B5CF6', // Purple
                        '#EC4899'  // Pink
                    ],
                    borderColor: 'transparent',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 4.0,
                        title: { display: true, text: 'Valore INR' },
                        grid: { color: '#E5E7EB' }
                    },
                    y: { grid: { display: false } }
                },
                plugins: {
                    ...tooltipPlugin.plugins,
                    legend: { display: false },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                xMin: 2.0,
                                xMax: 2.0,
                                borderColor: 'red',
                                borderWidth: 2,
                                borderDash: [6, 6],
                                label: { content: 'Soglia Critica Standard', enabled: true }
                            }
                        }
                    }
                }
            }
        });

        // --- CHART 3: OVERLAP TIMELINE (Floating Bar - Gantt Style) ---
        const ctxOverlap = document.getElementById('overlapChart').getContext('2d');
        new Chart(ctxOverlap, {
            type: 'bar',
            data: {
                labels: ['Giorno 1', 'Giorno 2', 'Giorno 3', 'Giorno 4 (Check INR)', 'Giorno 5 (Target Raggiunto)'].map(splitLabel),
                datasets: [
                    {
                        label: 'DOAC (Terapia in corso)',
                        data: [ [0, 1], [0, 1], [0, 1], [0, 1], [0, 0] ], // Ends on day 5
                        backgroundColor: '#7C3AED', // Violet
                        barPercentage: 0.5,
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Warfarin (Induzione)',
                        data: [ [0, 0.5], [0, 0.7], [0, 0.9], [0, 1.0], [0, 1.0] ], // Starts growing graphically
                        // Note: Data here represents "Presence/Intensity", functionally timeline is just "Active"
                        // To visualize overlap properly as bars:
                        // This is a stylistic representation.
                        hidden: true 
                    }
                ]
            },
            // Re-creating dataset for visual clarity of "Two bars overlapping"
            // Actually, best way for Gantt in Chart.js without date adapter:
            // Use floating bars [start, end] on Y axis for Category X? No, simpler.
            // Let's use simple stacked bar to show volume of drugs.
            data: {
                labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5+'],
                datasets: [
                    {
                        label: 'DOAC',
                        data: [100, 100, 100, 100, 0], // Stops when INR target hit
                        backgroundColor: 'rgba(124, 58, 237, 0.8)',
                    },
                    {
                        label: 'Warfarin (VKA)',
                        data: [20, 40, 60, 80, 100], // Accumulating effect
                        backgroundColor: 'rgba(245, 158, 11, 0.8)',
                    },
                    {
                        label: 'INR Stimato',
                        type: 'line',
                        data: [1.1, 1.3, 1.6, 1.9, 2.5],
                        borderColor: '#EC4899',
                        borderWidth: 3,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { display: false } },
                    y: { 
                        display: false, 
                        stacked: false, // Changed to false to show side-by-side comparison of drug presence
                        title: { display: true, text: 'Attività Farmacologica (%)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'Valore INR', color: '#EC4899' },
                        grid: { drawOnChartArea: false }
                    }
                },
                plugins: tooltipPlugin.plugins
            }
        });

        // --- CHART 4: RENAL FUNCTION (Grouped Bar) ---
        // Showing Contraindication Thresholds
        const ctxRenal = document.getElementById('renalChart').getContext('2d');
        new Chart(ctxRenal, {
            type: 'bar',
            data: {
                labels: ['Dabigatran', 'Rivaroxaban', 'Apixaban', 'Edoxaban'].map(splitLabel),
                datasets: [
                    {
                        label: 'Controindicato se CrCl < (ml/min)',
                        data: [30, 15, 15, 15], // Absolute cutoff
                        backgroundColor: '#EF4444', // Red
                        order: 1
                    },
                    {
                        label: 'Riduzione Dose se CrCl < (ml/min)',
                        data: [50, 50, 30, 50], // Adjustment threshold
                        backgroundColor: '#FCD34D', // Amber Light
                        order: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'CrCl (ml/min)' }
                    }
                },
                plugins: {
                    ...tooltipPlugin.plugins,
                    legend: { position: 'top' }
                }
            }
        });

    </script>
</body>
</html>