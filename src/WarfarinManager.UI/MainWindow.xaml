<Window
    x:Class="WarfarinManager.UI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:WarfarinManager.UI.ViewModels"
    Title="TaoGEST - Gestione Terapia Anticoagulante Orale"
    Width="1050"
    Height="600"
    MinWidth="900"
    MinHeight="500"
    d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
    WindowStartupLocation="CenterScreen"
    Icon="Resources/Icons/taogest.ico"
    Background="{DynamicResource WindowBackgroundBrush}"
    mc:Ignorable="d">

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewPatientCommand}" />
        <KeyBinding Key="L" Modifiers="Ctrl" Command="{Binding ShowPatientListCommand}" />
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding SearchPatientCommand}" />
        <KeyBinding Key="T" Modifiers="Ctrl" Command="{Binding ToggleThemeCommand}" />
        <KeyBinding Key="F1" Command="{Binding ShowUserGuideCommand}" />
        <KeyBinding Key="F2" Command="{Binding ShowDocumentBrowserCommand}" />
        <KeyBinding Key="F1" Modifiers="Shift" Command="{Binding ShowProfessionalGuidesDialogCommand}" />
    </Window.InputBindings>

    <Grid Background="{DynamicResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Menu  -->
        <Menu Grid.Row="0"
              Background="{DynamicResource WindowBackgroundBrush}"
              Foreground="{DynamicResource TextPrimaryBrush}">
            <!--  File Menu  -->
            <MenuItem Header="_File">
                <MenuItem
                    Command="{Binding ExportDataCommand}"
                    Header="Esporta dati..." />
                <MenuItem Header="Importa dati...">
                    <MenuItem
                        Command="{Binding ImportDataCommand}"
                        Header="Importa pazienti da Millewin...">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                                <Setter Property="ToolTip" Value="Importa pazienti dal database Millewin"/>
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="ToolTip" Value="Integrazione Millewin non attiva. Vai in Opzioni > Preferenze per abilitarla."/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>
                    <MenuItem
                        Command="{Binding ImportINRCommand}"
                        Header="Importa INR..." />
                </MenuItem>
                <Separator />
                <MenuItem
                    Command="{Binding ExitCommand}"
                    Header="Esci"
                    InputGestureText="Alt+F4" />
            </MenuItem>

            <!--  Pazienti Menu  -->
            <MenuItem Header="_Pazienti">
                <MenuItem
                    Command="{Binding NewPatientCommand}"
                    Header="Nuovo paziente"
                    InputGestureText="Ctrl+N" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowPatientListCommand}"
                    Header="Lista pazienti"
                    InputGestureText="Ctrl+L" />
                <MenuItem
                    Command="{Binding SearchPatientCommand}"
                    Header="Cerca paziente..."
                    InputGestureText="Ctrl+F" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowPatientStatisticsCommand}"
                    Header="Statistiche pazienti" />
            </MenuItem>

            <!--  Strumenti Menu  -->
            <MenuItem Header="_Strumenti">
                <MenuItem
                    Command="{Binding ShowInteractionCheckerCommand}"
                    Header="Verifica interazioni farmacologiche" />
                <MenuItem
                    Command="{Binding ShowBridgeTherapyCommand}"
                    Header="Gestione bridge therapy" />
                <MenuItem
                    Command="{Binding ShowSwitchTherapyCommand}"
                    Header="ðŸ”„ Switch Terapia (Warfarin â†” DOAC)" />
                <MenuItem
                    Command="{Binding ShowDoacGestSimulatorCommand}"
                    Header="ðŸ§ª DoacGest Simulatore - Paziente ipotetico"
                    ToolTip="Calcolatore avanzato DOAC per simulazioni su pazienti ipotetici (React WebView2)" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowDrugDatabaseCommand}"
                    Header="Database farmaci interagenti" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowWeeklyDoseCalculatorCommand}"
                    Header="Calcola dose settimanale warfarin" />
                <MenuItem
                    Command="{Binding ShowInitialDosageEstimatorCommand}"
                    Header="Stima dosaggio warfarin (Nomogramma Pengo)" />
            </MenuItem>

            <!--  Opzioni Menu  -->
            <MenuItem Header="_Opzioni">
                <MenuItem
                    Command="{Binding ShowDoctorDataCommand}"
                    Header="Dati del medico..." />
                <MenuItem
                    Command="{Binding ShowPreferencesCommand}"
                    Header="Preferenze applicazione..." />
                <Separator />
                <MenuItem
                    Click="ThemeToggle_Click"
                    Header="Cambia tema (Chiaro/Scuro)"
                    InputGestureText="Ctrl+T">
                    <MenuItem.Icon>
                        <TextBlock x:Name="MenuThemeIcon"
                                   Text="{StaticResource Icon.Moon}"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="16"
                                   Foreground="{DynamicResource PrimaryBrush}" />
                    </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem
                    Command="{Binding ShowDatabaseSettingsCommand}"
                    Header="Impostazioni database..." />
            </MenuItem>

            <!--  Aiuto Menu  -->
            <MenuItem Header="_Aiuto">
                <MenuItem
                    Command="{Binding ShowUserGuideCommand}"
                    Header="ðŸ“– Guida utente"
                    InputGestureText="F1" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowDocumentBrowserCommand}"
                    Header="ðŸ“š Biblioteca Documenti..."
                    InputGestureText="F2"
                    ToolTip="Accedi a tutte le guide, linee guida, RCP DOAC e documenti di riferimento con ricerca integrata" />
                <Separator />
                <MenuItem Header="ðŸ“‹ Warfarin / TAO">
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="interactions.html"
                        Header="ðŸ’Š Interazioni Farmacologiche" />
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="algoritmo-gestione-inr.html"
                        Header="ðŸ“Š Flowchart Gestione INR" />
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="infografica-tao.html"
                        Header="ðŸ“‹ Infografica Gestione TAO" />
                    <Separator />
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="linee-guida-tao.html"
                        Header="ðŸ“„ Guida TAO per MMG (Testo)" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="LineeGuida.pdf"
                        Header="ðŸ“• Guida TAO per MMG (PDF)" />
                </MenuItem>
                <MenuItem Header="ðŸ’Š DOAC (NAO)">
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="DoacsInteractions.html"
                        Header="ðŸ” Checker Interazioni DOAC" />
                    <Separator />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="RCP_apixaban.pdf"
                        Header="ðŸ“• RCP Apixaban (Eliquis)" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="RCP_rivaroxaban.pdf"
                        Header="ðŸ“• RCP Rivaroxaban (Xarelto)" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="RCP_dabigatran.pdf"
                        Header="ðŸ“• RCP Dabigatran (Pradaxa)" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="RCP_edoxaban.pdf"
                        Header="ðŸ“• RCP Edoxaban (Lixiana)" />
                </MenuItem>
                <MenuItem Header="ðŸ”„ Switch Terapia">
                    <MenuItem
                        Command="{Binding ShowProfessionalGuideCommand}"
                        CommandParameter="guida-switch-infografica.html"
                        Header="ðŸ“Š Infografica Switch DOAC â†” Warfarin" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="Switch_Doac_Warf.pdf"
                        Header="ðŸ“• Guida Dettagliata (PDF)" />
                </MenuItem>
                <MenuItem Header="ðŸ“š Linee Guida">
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="lgFCSA-SIMG-2018.pdf"
                        Header="ðŸ“š FCSA-SIMG 2018" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="lgFCSA.pdf"
                        Header="ðŸ“š FCSA" />
                    <MenuItem
                        Command="{Binding OpenPdfGuideCommand}"
                        CommandParameter="lgESC2024-raffronto-con-altre.pdf"
                        Header="ðŸ“š ESC 2024 - Raffronto" />
                </MenuItem>
                <Separator />
                <MenuItem
                    Command="{Binding OpenPdfGuideCommand}"
                    CommandParameter="Guida Warfarin per pazienti.pdf"
                    Header="ðŸ‘¥ Guida per pazienti" />
                <Separator />
                <MenuItem
                    Command="{Binding CheckUpdatesCommand}"
                    Header="ðŸ”„ Verifica aggiornamenti" />
                <Separator />
                <MenuItem
                    Command="{Binding ShowAboutCommand}"
                    Header="â„¹ï¸ About TaoGEST..." />
            </MenuItem>
        </Menu>

        <!--  Content Area  -->
        <ContentControl x:Name="ContentArea"
                        Grid.Row="1"
                        Background="{DynamicResource ContentBackgroundBrush}" />

        <!--  Status Bar  -->
        <Border
            Grid.Row="2"
            Padding="10,5"
            Background="{DynamicResource StatusBarBackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock
                    Grid.Column="0"
                    FontSize="11"
                    Foreground="{DynamicResource TextSecondaryBrush}"
                    Text="Versione 1.4.0.0"
                    VerticalAlignment="Center" />

                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                    <TextBlock
                        Text="Tema:"
                        FontSize="11"
                        Foreground="{DynamicResource TextSecondaryBrush}"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0" />
                    <Button
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="Cambia tema (Chiaro/Scuro) - Ctrl+T"
                        Click="ThemeToggle_Click"
                        Width="36"
                        Height="28"
                        Padding="6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                x:Name="ThemeIcon"
                                Text="{StaticResource Icon.Moon}"
                                FontFamily="Segoe MDL2 Assets"
                                FontSize="16"
                                VerticalAlignment="Center"
                                Foreground="{DynamicResource PrimaryBrush}" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
